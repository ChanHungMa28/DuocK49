<!doctype html>
<html lang="vi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Quiz Hóa sinh – Độ tuyến tính & Bước sóng (40 câu)</title>
  <style>
    :root{
      --bg:#f6fbff;
      --card:#ffffff;
      --ink:#1f2a37;
      --muted:#516173;
      --line:#d8e6f3;
      --accent:#2f7dd1;
      --ok:#1f9d5b;
      --bad:#d64545;
      --warn:#b7791f;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      background:linear-gradient(180deg,#f6fbff 0%, #eef6ff 100%);
      color:var(--ink);
    }
    .wrap{max-width:980px;margin:24px auto;padding:16px}
    header{
      background:var(--card);
      border:1px solid var(--line);
      border-radius:16px;
      padding:18px 18px 14px;
      box-shadow:0 10px 30px rgba(31,42,55,.06);
    }
    h1{margin:0 0 6px;font-size:20px}
    .sub{margin:0;color:var(--muted);font-size:14px;line-height:1.4}
    .bar{
      display:flex;gap:10px;flex-wrap:wrap;align-items:center;
      margin-top:12px;
    }
    .pill{
      padding:8px 10px;border-radius:999px;border:1px solid var(--line);
      background:#f9fcff;color:var(--muted);font-size:13px;
    }
    .pill b{color:var(--ink)}
    .btn{
      border:1px solid var(--line);
      background:#f9fcff;
      color:var(--ink);
      padding:10px 12px;
      border-radius:12px;
      cursor:pointer;
      font-weight:600;
      transition:.15s transform, .15s background;
      user-select:none;
    }
    .btn:hover{transform:translateY(-1px);background:#f2f8ff}
    .btn.primary{
      border-color:rgba(47,125,209,.35);
      background:rgba(47,125,209,.10);
      color:#1c5ea3;
    }
    .grid{margin-top:16px;display:grid;gap:14px}
    .card{
      background:var(--card);
      border:1px solid var(--line);
      border-radius:16px;
      padding:14px;
      box-shadow:0 10px 30px rgba(31,42,55,.05);
    }
    .qhead{display:flex;gap:10px;align-items:flex-start;justify-content:space-between}
    .qtitle{margin:0;font-size:15px;line-height:1.5}
    .qmeta{color:var(--muted);font-size:12px;margin-top:2px}
    .opts{margin-top:10px;display:grid;gap:10px}
    .opt{
      border:1px solid var(--line);
      background:#fbfdff;
      border-radius:12px;
      padding:10px 12px;
      display:flex;gap:10px;align-items:flex-start;
      cursor:pointer;
      transition:.12s transform, .12s background, .12s border-color;
    }
    .opt:hover{transform:translateY(-1px);background:#f3f9ff;border-color:#cfe3f6}
    .opt[aria-disabled="true"]{cursor:not-allowed;opacity:.9}
    .badge{
      flex:0 0 auto;
      width:26px;height:26px;border-radius:8px;
      display:grid;place-items:center;
      border:1px solid var(--line);
      color:var(--muted);
      font-weight:800;
      background:#f7fbff;
      font-size:13px;
    }
    .opt.correct{
      border-color:rgba(31,157,91,.35);
      background:rgba(31,157,91,.10);
    }
    .opt.correct .badge{border-color:rgba(31,157,91,.35);color:var(--ok);background:rgba(31,157,91,.08)}
    .opt.wrong{
      border-color:rgba(214,69,69,.35);
      background:rgba(214,69,69,.10);
    }
    .opt.wrong .badge{border-color:rgba(214,69,69,.35);color:var(--bad);background:rgba(214,69,69,.08)}
    .feedback{
      margin-top:10px;
      display:flex;gap:10px;align-items:center;flex-wrap:wrap;
      color:var(--muted);
      font-size:13px;
    }
    .tag{
      padding:6px 10px;border-radius:999px;border:1px solid var(--line);
      background:#fbfdff;
      font-weight:700;
      color:var(--muted);
    }
    .tag.ok{border-color:rgba(31,157,91,.35);background:rgba(31,157,91,.10);color:var(--ok)}
    .tag.bad{border-color:rgba(214,69,69,.35);background:rgba(214,69,69,.10);color:var(--bad)}
    .tag.warn{border-color:rgba(183,121,31,.35);background:rgba(183,121,31,.10);color:var(--warn)}
    .mini-btn{
      padding:8px 10px;border-radius:12px;border:1px solid var(--line);
      background:#f9fcff;cursor:pointer;font-weight:700;color:var(--ink);
    }
    .mini-btn:hover{background:#f2f8ff}
    footer{margin:18px 2px;color:var(--muted);font-size:12px}
  </style>
</head>

<body>
  <div class="wrap">
    <header>
      <h1>Quiz Hóa sinh: Độ tuyến tính & Bước sóng (40 câu)</h1>
      <p class="sub">
        Cách làm: bấm chọn đáp án. Hệ thống sẽ báo Đúng/Sai.
        Nếu chọn sai, mặc định <b>không hiện đáp án đúng ngay</b> (bạn bấm “Xem đáp án” nếu muốn).
        Khi tải lại trang hoặc bấm “Trộn lại”, thứ tự đáp án sẽ đảo.
      </p>
      <div class="bar">
        <span class="pill">Tiến độ: <b id="prog">0/40</b></span>
        <span class="pill">Đúng: <b id="ok">0</b></span>
        <span class="pill">Sai: <b id="bad">0</b></span>
        <span class="pill">Điểm: <b id="score">0%</b></span>
        <button class="btn primary" id="shuffleBtn">Trộn lại (đảo đáp án)</button>
        <button class="btn" id="resetBtn">Làm lại</button>
      </div>
    </header>

    <main class="grid" id="quiz"></main>

    <footer>
      Gợi ý nhớ nhanh: Lipid quanh 500–578 nm; Enzyme thường 340 nm; Bilirubin 546 nm; Amylase 405 nm.
    </footer>
  </div>

<script>
  // =========================
  // DATA (40 QUESTIONS)
  // =========================
  const QUESTIONS = [
    // Bước sóng (1–24)
    { q: "Cholesterol toàn phần được đo ở bước sóng nào?", opts: ["340 nm","405 nm","500 nm","546 nm"], ans: 2 },
    { q: "Triglycerid sử dụng bước sóng nào?", opts: ["500 nm","505 nm","546 nm","578 nm"], ans: 1 },
    { q: "HDL-c được đo ở bước sóng nào?", opts: ["500 nm","505 nm","546 nm","578 nm"], ans: 3 },
    { q: "LDL-c thường được đo ở bước sóng nào?", opts: ["340 nm","405 nm","500 nm","578 nm"], ans: 2 },
    { q: "Acid uric được đo ở bước sóng nào?", opts: ["500 nm","505 nm","546 nm","578 nm"], ans: 1 },
    { q: "Ure huyết thanh được đo ở bước sóng nào?", opts: ["340 nm","405 nm","500 nm","546 nm"], ans: 0 },
    { q: "Bilirubin toàn phần hấp thụ tốt nhất tại bước sóng:", opts: ["340 nm","405 nm","500 nm","546 nm"], ans: 3 },
    { q: "Bilirubin trực tiếp được đo ở bước sóng:", opts: ["505 nm","546 nm","578 nm","340 nm"], ans: 1 },
    { q: "ALT (GPT) được định lượng tại bước sóng:", opts: ["340 nm","405 nm","500 nm","546 nm"], ans: 0 },
    { q: "AST (GOT) có bước sóng đo tương tự ALT là:", opts: ["405 nm","500 nm","340 nm","578 nm"], ans: 2 },
    { q: "CK-MB máu được đo ở bước sóng nào?", opts: ["546 nm","505 nm","405 nm","340 nm"], ans: 3 },
    { q: "Amylase huyết thanh được đo tại bước sóng:", opts: ["340 nm","405 nm","500 nm","546 nm"], ans: 1 },
    { q: "Cặp xét nghiệm nào có cùng bước sóng 500 nm?", opts: ["Cholesterol TP & LDL-c","Triglycerid & Acid uric","ALT & AST","Bili TP & Bili TT"], ans: 0 },
    { q: "Cặp xét nghiệm nào có cùng bước sóng 505 nm?", opts: ["HDL-c & LDL-c","Triglycerid & Acid uric","Ure & CK-MB","Bilirubin TP & ALT"], ans: 1 },
    { q: "Cặp xét nghiệm nào có cùng bước sóng 546 nm?", opts: ["Bilirubin TP & Bilirubin TT","Cholesterol & Triglycerid","ALT & Amylase","Ure & HDL"], ans: 0 },
    { q: "Nhóm nào sau đây chủ yếu đo ở 340 nm?", opts: ["ALT/AST/CK-MB","HDL/LDL/Cholesterol","Bilirubin TP/TT","Triglycerid/Acid uric"], ans: 0 },
    { q: "Xét nghiệm có bước sóng 578 nm là:", opts: ["HDL-c","LDL-c","Bilirubin TP","Triglycerid"], ans: 0 },
    { q: "Xét nghiệm có bước sóng 405 nm là:", opts: ["Ure","Amylase huyết thanh","ALT","Bilirubin trực tiếp"], ans: 1 },
    { q: "Xét nghiệm có bước sóng 340 nm là:", opts: ["LDL-c","Triglycerid","ALT/GPT","Bilirubin TP"], ans: 2 },
    { q: "Trong bảng, bước sóng nào thuộc vùng 'cao nhất'?", opts: ["340 nm","405 nm","546 nm","578 nm"], ans: 3 },
    { q: "Cặp nào sau đây KHÔNG cùng bước sóng?", opts: ["ALT & AST","Triglycerid & Acid uric","Cholesterol & LDL-c","Ure & HDL-c"], ans: 3 },
    { q: "Bilirubin trực tiếp có bước sóng:", opts: ["500 nm","505 nm","546 nm","578 nm"], ans: 2 },
    { q: "LDL-c có bước sóng:", opts: ["340 nm","405 nm","500 nm","546 nm"], ans: 2 },
    { q: "Ure có bước sóng:", opts: ["340 nm","405 nm","500 nm","578 nm"], ans: 0 },

    // Độ tuyến tính (25–40)
    { q: "Độ tuyến tính của cholesterol toàn phần là:", opts: ["Đến 300 mg/dl","Đến 750 mg/dl","Đến 1000 mg/dl","Đến 1500 mg/dl"], ans: 1 },
    { q: "Triglycerid có độ tuyến tính trong khoảng:", opts: ["1,9–193 mg/dl","0,49–25 mg/dl","9,74–1062 mg/dl","11,5–300 mg/dl"], ans: 2 },
    { q: "HDL-c có độ tuyến tính:", opts: ["0–20 mg/dl","1,9–193 mg/dl","9,74–1062 mg/dl","Đến 1000 mg/dl"], ans: 1 },
    { q: "LDL-c đo tuyến tính tối đa đến:", opts: ["750 mg/dl","1000 mg/dl","300 mg/dl","193 mg/dl"], ans: 1 },
    { q: "Acid uric có khoảng tuyến tính:", opts: ["0–20 mg/dl","1,9–193 mg/dl","0,49–25 mg/dl","11,5–300 mg/dl"], ans: 2 },
    { q: "Ure huyết thanh có độ tuyến tính:", opts: ["4,4–360 U/L","11,5–300 mg/dl","0,18–23 mg/dl","7,1–1200 U/L"], ans: 1 },
    { q: "Bilirubin toàn phần có khoảng đo:", opts: ["0–20 mg/dl","0,18–23 mg/dl","11,5–300 mg/dl","0,49–25 mg/dl"], ans: 0 },
    { q: "Bilirubin trực tiếp có độ tuyến tính:", opts: ["0–20 mg/dl","1,9–193 mg/dl","0,18–23 mg/dl","9,74–1062 mg/dl"], ans: 2 },
    { q: "ALT (GPT) có độ tuyến tính:", opts: ["3,84–390 U/L","4,4–360 U/L","7,1–1200 U/L","10,8–1500 U/L"], ans: 1 },
    { q: "AST (GOT) có khoảng đo tuyến tính:", opts: ["4,4–360 U/L","3,84–390 U/L","7,1–1200 U/L","10,8–1500 U/L"], ans: 1 },
    { q: "CK-MB máu có độ tuyến tính:", opts: ["4,4–360 U/L","3,84–390 U/L","7,1–1200 U/L","10,8–1500 U/L"], ans: 2 },
    { q: "Amylase huyết thanh có khoảng tuyến tính:", opts: ["7,1–1200 U/L","4,4–360 U/L","10,8–1500 U/L","11,5–300 mg/dl"], ans: 2 },
    { q: "Xét nghiệm có giới hạn tuyến tính 'đến 750 mg/dl' là:", opts: ["LDL-c","Cholesterol toàn phần","Triglycerid","HDL-c"], ans: 1 },
    { q: "Xét nghiệm có giới hạn tuyến tính 'đến 1000 mg/dl' là:", opts: ["LDL-c","HDL-c","Acid uric","Bilirubin trực tiếp"], ans: 0 },
    { q: "Khoảng tuyến tính 0,49–25 mg/dl thuộc về:", opts: ["Bilirubin TP","Ure","Acid uric","HDL-c"], ans: 2 },
    { q: "Khoảng tuyến tính 0,18–23 mg/dl thuộc về:", opts: ["Bilirubin trực tiếp","Bilirubin toàn phần","Triglycerid","Cholesterol"], ans: 0 }
  ];

  // =========================
  // STATE
  // =========================
  let state = {
    items: [],           // each item: {q, options: [{text,isCorrect}], locked, chosenIndex, revealed}
    correct: 0,
    wrong: 0,
    answered: 0
  };

  const elQuiz = document.getElementById("quiz");
  const elProg = document.getElementById("prog");
  const elOk = document.getElementById("ok");
  const elBad = document.getElementById("bad");
  const elScore = document.getElementById("score");

  // =========================
  // HELPERS
  // =========================
  function shuffle(arr){
    const a = arr.slice();
    for(let i=a.length-1;i>0;i--){
      const j = Math.floor(Math.random()*(i+1));
      [a[i],a[j]] = [a[j],a[i]];
    }
    return a;
  }

  function buildState(){
    state.correct = 0;
    state.wrong = 0;
    state.answered = 0;

    state.items = QUESTIONS.map((it) => {
      const mapped = it.opts.map((t, idx) => ({ text: t, isCorrect: idx === it.ans }));
      return {
        q: it.q,
        options: shuffle(mapped),  // đảo đáp án
        locked: false,
        chosenIndex: null,
        revealed: false
      };
    });
  }

  function updateHeader(){
    elProg.textContent = `${state.answered}/40`;
    elOk.textContent = state.correct;
    elBad.textContent = state.wrong;
    const pct = Math.round((state.correct / 40) * 100);
    elScore.textContent = `${pct}%`;
  }

  function optionLetter(i){
    return String.fromCharCode(65+i); // A, B, C, D
  }

  // =========================
  // RENDER
  // =========================
  function render(){
    elQuiz.innerHTML = "";

    state.items.forEach((item, qi) => {
      const card = document.createElement("section");
      card.className = "card";
      card.dataset.qi = qi;

      const head = document.createElement("div");
      head.className = "qhead";

      const left = document.createElement("div");

      const title = document.createElement("p");
      title.className = "qtitle";
      title.textContent = `Câu ${qi+1}. ${item.q}`;

      const meta = document.createElement("div");
      meta.className = "qmeta";
      meta.textContent = item.locked ? "Đã trả lời" : "Chưa trả lời";

      left.appendChild(title);
      left.appendChild(meta);

      head.appendChild(left);
      card.appendChild(head);

      const opts = document.createElement("div");
      opts.className = "opts";

      item.options.forEach((op, oi) => {
        const row = document.createElement("div");
        row.className = "opt";
        row.setAttribute("role","button");
        row.setAttribute("tabindex","0");
        row.setAttribute("aria-disabled", item.locked ? "true" : "false");

        const badge = document.createElement("div");
        badge.className = "badge";
        badge.textContent = optionLetter(oi);

        const text = document.createElement("div");
        text.textContent = op.text;

        // Styling after answered/revealed
        if(item.locked){
          if(item.chosenIndex === oi){
            row.classList.add(op.isCorrect ? "correct" : "wrong");
          }
          // Only reveal correct option when item.revealed === true
          if(item.revealed && op.isCorrect){
            row.classList.add("correct");
          }
        }

        row.appendChild(badge);
        row.appendChild(text);

        const pick = () => {
          if(item.locked) return;
          item.locked = true;
          item.chosenIndex = oi;
          state.answered += 1;
          if(op.isCorrect) state.correct += 1;
          else state.wrong += 1;
          updateHeader();
          render(); // re-render to lock + colorize
        };

        row.addEventListener("click", pick);
        row.addEventListener("keydown", (e) => {
          if(e.key === "Enter" || e.key === " "){
            e.preventDefault();
            pick();
          }
        });

        opts.appendChild(row);
      });

      card.appendChild(opts);

      // feedback area
      const fb = document.createElement("div");
      fb.className = "feedback";

      if(item.locked){
        const chosen = item.options[item.chosenIndex];
        const tag = document.createElement("span");
        tag.className = "tag " + (chosen.isCorrect ? "ok" : "bad");
        tag.textContent = chosen.isCorrect ? "ĐÚNG" : "SAI";

        fb.appendChild(tag);

        if(!chosen.isCorrect){
          const hint = document.createElement("span");
          hint.className = "tag warn";
          hint.textContent = "Bạn có thể bấm “Xem đáp án” để hiện đáp án đúng";
          fb.appendChild(hint);

          const revealBtn = document.createElement("button");
          revealBtn.className = "mini-btn";
          revealBtn.textContent = item.revealed ? "Đã hiện đáp án" : "Xem đáp án";
          revealBtn.disabled = item.revealed;
          revealBtn.addEventListener("click", () => {
            item.revealed = true;
            render();
          });
          fb.appendChild(revealBtn);
        }
      } else {
        const tag = document.createElement("span");
        tag.className = "tag";
        tag.textContent = "Chọn 1 đáp án";
        fb.appendChild(tag);
      }

      card.appendChild(fb);
      elQuiz.appendChild(card);
    });

    updateHeader();
  }

  // =========================
  // BUTTONS
  // =========================
  document.getElementById("resetBtn").addEventListener("click", () => {
    buildState();
    render();
    window.scrollTo({top:0,behavior:"smooth"});
  });

  document.getElementById("shuffleBtn").addEventListener("click", () => {
    // trộn lại đáp án, giữ nguyên câu hỏi (đặt lại trạng thái làm bài)
    buildState();
    render();
    window.scrollTo({top:0,behavior:"smooth"});
  });

  // =========================
  // INIT
  // =========================
  buildState();
  render();
</script>
</body>
</html>
